<section class="preset-list" data-testid="preset-list" [class.preset-list--edit-mode]="editMode()">
  <div class="preset-list__header">
    <h3 class="preset-list__title">{{ 'presets.title' | translate }}</h3>
    <button
      type="button"
      class="preset-list__settings-btn"
      data-testid="preset-settings-button"
      (click)="toggleEditMode()"
      [attr.aria-label]="'presets.settings' | translate"
      [attr.aria-pressed]="editMode()"
    >
      <span class="preset-list__settings-icon" aria-hidden="true">⚙</span>
    </button>
  </div>

  @if (loading()) {
    <div class="preset-list__loading">{{ 'common.loading' | translate }}</div>
  } @else if (error()) {
    <div class="preset-list__error">{{ error() }}</div>
  } @else {
    <div class="preset-list__grid">
      @for (preset of presets(); track trackByPresetId($index, preset)) {
        <div class="preset-item" data-testid="preset-item">
          <button
            type="button"
            class="preset-item__play-btn"
            data-testid="preset-play-button"
            [class.preset-item__play-btn--playing]="playingPresetId() === preset.id"
            [class.preset-item__play-btn--power-off]="!isPowerOn()"
            [disabled]="playingPresetId() !== null"
            [style.background-image]="'url(' + getPresetIcon(preset) + ')'"
            (click)="playPreset(preset)"
            [attr.aria-label]="('presets.play' | translate) + ' ' + preset.name"
            [attr.title]="!isPowerOn() ? ('presets.willPowerOn' | translate) : preset.name"
          >
            @if (playingPresetId() === preset.id) {
              <span class="preset-item__spinner" aria-hidden="true"></span>
            } @else {
              <span class="preset-item__play-icon" aria-hidden="true">▶</span>
            }
          </button>
          <button
            type="button"
            class="preset-item__name"
            data-testid="preset-name-button"
            (click)="onPresetNameClick(preset)"
            [attr.aria-label]="editMode() ? (('presets.edit' | translate) + ' ' + preset.name) : preset.name"
          >
            @if (editMode()) {
              <span class="preset-item__edit-icon" aria-hidden="true">✎</span>
            }
            {{ preset.name }}
          </button>
        </div>
      }

      <!-- Add new preset button -->
      @if (editMode()) {
        <div class="preset-item preset-item--add" data-testid="preset-add-item">
          <button
            type="button"
            class="preset-item__add-btn"
            data-testid="preset-add-button"
            (click)="navigateToNewPreset()"
            [attr.aria-label]="'presets.addNew' | translate"
          >
            <span class="preset-item__add-icon" aria-hidden="true">+</span>
          </button>
          <span class="preset-item__label">{{ 'presets.addNew' | translate }}</span>
        </div>
      }
    </div>

    @if (editMode()) {
      <div class="preset-list__footer">
        <button
          type="button"
          class="preset-list__back-btn"
          data-testid="preset-back-button"
          (click)="exitEditMode()"
        >
          {{ 'presets.backToPlayMode' | translate }}
        </button>
      </div>
    }
  }
</section>
