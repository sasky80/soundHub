<div class="device-details-page">
  <header class="page-header">
    <a routerLink="/" class="back-link">‚Üê {{ 'deviceDetails.back' | translate }}</a>
    <h1>{{ 'deviceDetails.title' | translate }}</h1>
  </header>

  @if (loading()) {
    <div class="loading">{{ 'common.loading' | translate }}</div>
  } @else if (error()) {
    <div class="error">{{ error() }}</div>
  } @else if (device(); as d) {
    <div class="device-info">
      <h2 class="device-name">{{ d.name }}</h2>
      <p class="device-vendor">{{ d.vendor }}</p>
    </div>

    @if (status(); as s) {
      <section class="control-section">
        <div class="control-row">
          <span class="control-label">{{ 'deviceDetails.power' | translate }}</span>
          <button
            class="power-btn"
            [class.on]="s.powerState"
            [disabled]="powerLoading()"
            (click)="togglePower()"
          >
            @if (powerLoading()) {
              ...
            } @else if (s.powerState) {
              {{ 'deviceDetails.powerOn' | translate }}
            } @else {
              {{ 'deviceDetails.powerOff' | translate }}
            }
          </button>
        </div>

        <div class="control-row volume-control">
          <span class="control-label">{{ 'deviceDetails.volume' | translate }}</span>
          <div class="volume-slider-container" [class.disabled]="!s.powerState">
            @if (volumeLoading()) {
              <span class="volume-loading">...</span>
            } @else {
              <input
                type="range"
                min="0"
                max="100"
                [value]="volumeValue()"
                [disabled]="!s.powerState"
                (input)="onVolumeInput($event)"
                class="volume-slider"
                [attr.aria-label]="'deviceDetails.volume' | translate"
                [attr.title]="!s.powerState ? ('deviceDetails.volumeDisabled' | translate) : null"
              />
              <span class="volume-value">{{ volumeValue() }}</span>
            }
          </div>
        </div>

        <div class="control-row">
          <span class="control-label">{{ 'deviceDetails.mute' | translate }}</span>
          <button
            class="mute-btn"
            [class.muted]="volumeInfo()?.isMuted"
            [disabled]="!s.powerState || muteLoading()"
            (click)="toggleMute()"
            [attr.title]="!s.powerState ? ('deviceDetails.volumeDisabled' | translate) : null"
          >
            @if (muteLoading()) {
              ...
            } @else if (volumeInfo()?.isMuted) {
              {{ 'deviceDetails.unmute' | translate }}
            } @else {
              {{ 'deviceDetails.mute' | translate }}
            }
          </button>
        </div>

        <!-- Preset List -->
        <lib-preset-list
          [deviceId]="d.id"
          [isPowerOn]="s.powerState"
          (powerStateChanged)="onPresetPowerStateChanged($event)"
        />
      </section>
    }
  }
</div>
